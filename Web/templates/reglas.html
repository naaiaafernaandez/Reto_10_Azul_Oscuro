<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lookiero- Reglas de Estilo</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">-->
    <link rel="stylesheet" href="/static/styles.css">
     
    <style>
        .level-card {
            border-left: 4px solid var(--brand-primary);
            transition: transform 0.3s ease;
        }
        .level-card:hover {
            transform: translateY(-5px);
        }
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85rem;
            max-height: 400px;
            overflow-y: auto;
        }
        .rule-check { color: var(--brand-primary); font-weight: bold; margin-right: 10px; }
        .rule-bad { color: #E0334D; font-weight: bold; margin-right: 10px; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-light shadow-sm">
      <div class="container">
        <a class="navbar-brand fw-bold" href="index.html">Lookiero</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item"><a class="nav-link" href="charts.html">Gráficos</a></li>
            <li class="nav-item"><a class="nav-link active" aria-current="page" href="reglas.html">Reglas</a></li>
            <li class="nav-item"><a class="nav-link" href="wheel2.html">Colores</a></li>
            <li class="nav-item"><a class="nav-link" href="ejemplos.html">Ejemplos Looks</a></li>
            <li class="nav-item"><a class="nav-link" href="bigdata.html">Generador AI</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="py-5 border-bottom" style="background-color: var(--bg-body);">
        <div class="container">
            <h2 class="fw-bold mb-0">Reglas de Combinación (Matching)</h2>
            <p class="text-secondary mt-2 mb-0">Definición de aristas y conexiones del grafo de estilo.</p>
        </div>
    </div>

    <div class="container py-5">
        
        <h4 class="mb-4 fw-bold text-dark"><i class="bi bi-layers-half me-2" style="color: var(--brand-primary);"></i>1. Niveles y Jerarquía</h4>
        <p class="text-muted mb-4">Para la generación de grafos, las prendas se clasifican en tres niveles estructurales.</p>
        
        <div class="row g-4 mb-5">
            <div class="col-md-4">
                <div class="card h-100 shadow-sm level-card border-0">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="card-title fw-bold m-0">Nivel 1</h5>
                            <span class="badge rounded-pill bg-dark">Base</span>
                        </div>
                        <p class="card-text text-secondary">Prendas principales inferiores o de cuerpo entero.</p>
                        <ul class="list-group list-group-flush small">
                            <li class="list-group-item px-0"><i class="bi bi-check2 text-success"></i> Pantalones</li>
                            <li class="list-group-item px-0"><i class="bi bi-check2 text-success"></i> Vestidos / Monos</li>
                            <li class="list-group-item px-0"><i class="bi bi-check2 text-success"></i> Faldas</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card h-100 shadow-sm level-card border-0">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="card-title fw-bold m-0">Nivel 2</h5>
                            <span class="badge rounded-pill" style="background-color: var(--brand-primary);">Superior</span>
                        </div>
                        <p class="card-text text-secondary">Prendas superiores ligeras.</p>
                        <ul class="list-group list-group-flush small">
                            <li class="list-group-item px-0"><i class="bi bi-check2 text-success"></i> Camisetas</li>
                            <li class="list-group-item px-0"><i class="bi bi-check2 text-success"></i> Jerséis / Tops</li>
                            <li class="list-group-item px-0"><i class="bi bi-check2 text-success"></i> Blusas</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card h-100 shadow-sm level-card border-0">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="card-title fw-bold m-0">Nivel 3</h5>
                            <span class="badge rounded-pill bg-secondary">Cierre</span>
                        </div>
                        <p class="card-text text-secondary">Capas exteriores y accesorios.</p>
                        <ul class="list-group list-group-flush small">
                            <li class="list-group-item px-0"><i class="bi bi-check2 text-success"></i> Abrigos / Chaquetas</li>
                            <li class="list-group-item px-0"><i class="bi bi-check2 text-success"></i> Bufandas</li>
                            <li class="list-group-item px-0"><i class="bi bi-check2 text-success"></i> Bolsos / Complementos</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <h4 class="mb-4 fw-bold text-dark mt-5"><i class="bi bi-diagram-3 me-2" style="color: var(--brand-primary);"></i>2. Reglas de Composición (Aristas)</h4>
        
        <div class="row mb-5">
            <div class="col-lg-6 mb-4">
                <div class="card border-0 shadow-sm p-4 h-100">
                    <h5 class="fw-bold mb-3">Looks Válidos (Triángulos)</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><i class="bi bi-check-circle-fill rule-check"></i> Nivel 1 + Nivel 2 + Nivel 3 <span class="text-muted small">(Pantalón + Top + Chaqueta)</span></li>
                        <li class="mb-2"><i class="bi bi-check-circle-fill rule-check"></i> Nivel 1 + Nivel 3 + Nivel 3 <span class="text-muted small">(Vestido + Chaqueta + Bufanda)</span></li>
                        <li class="mb-2"><i class="bi bi-check-circle-fill rule-check"></i> Nivel 1 + Nivel 2 + Nivel 2 <span class="text-muted small">(Falda + Camiseta + Jersey)</span></li>
                    </ul>
                </div>
            </div>
            <div class="col-lg-6 mb-4">
                <div class="card border-0 shadow-sm p-4 h-100" style="background-color: #FFF5F5;">
                    <h5 class="fw-bold mb-3 text-danger">Restricciones Hard</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><i class="bi bi-x-circle-fill rule-bad"></i> Prohibido conectar dos prendas de Nivel 1.</li>
                        <li class="mb-2"><i class="bi bi-x-circle-fill rule-bad"></i> Temporada: Todas las prendas deben ser de la misma season.</li>
                        <li class="mb-2"><i class="bi bi-x-circle-fill rule-bad"></i> No se permite duplicidad de ID (misma prenda, diferente color).</li>
                    </ul>
                </div>
            </div>
        </div>

        <h4 class="mb-4 fw-bold text-dark mt-5"><i class="bi bi-palette me-2" style="color: var(--brand-primary);"></i>3. Algoritmo de Color</h4>
        <p class="text-muted">La lógica matemática aplicada sobre la rueda cromática de 12 segmentos.</p>

        <div class="row g-4">
            <div class="col-md-5">
                <div class="list-group shadow-sm">
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                          <h6 class="mb-1 fw-bold">0. Neutros</h6>
                          <small style="color: var(--text-main);">Wildcard</small>
                        </div>
                        <p class="mb-1 small">Blanco, Negro (y códigos especiales) combinan con <strong>todo</strong>.</p>
                    </div>
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                          <h6 class="mb-1 fw-bold">1. Monocromáticas</h6>
                          <small style="color: var(--text-main);">Mismo Matiz</small>
                        </div>
                        <p class="mb-1 small">Si Matiz A == Matiz B, la diferencia de intensidad debe ser <strong>>= 2</strong>.</p>
                    </div>
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                          <h6 class="mb-1 fw-bold">2. Análogas</h6>
                          <small style="color: var(--text-main);">Vecinos</small>
                        </div>
                        <p class="mb-1 small">Distancia en rueda = <strong>1</strong> (o 11 para cierre).</p>
                    </div>
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                          <h6 class="mb-1 fw-bold">3. Complementarias</h6>
                          <small style="color: var(--text-main);">Opuestos</small>
                        </div>
                        <p class="mb-1 small">Distancia exacta de <strong>6</strong> pasos.</p>
                    </div>
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                          <h6 class="mb-1 fw-bold">4. Triádicas</h6>
                          <small style="color: var(--text-main);">Triángulo</small>
                        </div>
                        <p class="mb-1 small">Distancia de <strong>4</strong> u <strong>8</strong> pasos.</p>
                    </div>
                </div>
            </div>

            <div class="col-md-7">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                        <small>reglas.py</small>
                        <span class="badge bg-secondary">Python</span>
                    </div>
                    <div class="card-body p-0">
<pre class="code-block m-0 rounded-0 h-100">
def calcular_peso_outfit(p1, p2):
    # =========================================================
    # FASE 1-4: FILTROS TÉCNICOS (IDÉNTICOS A TU VALIDACIÓN)
    # =========================================================
    t1, t2 = p1.get('tiempo', set()), p2.get('tiempo', set())
    WARM_TAGS = {'warm'}
    COLD_TAGS = {'cold'}
    is_warm1, is_cold1 = not t1.isdisjoint(WARM_TAGS), not t1.isdisjoint(COLD_TAGS)
    is_warm2, is_cold2 = not t2.isdisjoint(WARM_TAGS), not t2.isdisjoint(COLD_TAGS)
    if (is_warm1 and is_cold2) or (is_cold1 and is_warm2):
        return 0.0
    if t1 and t2:
        score_tiempo = 1.5 #Cold+cold o warm+warm
    elif t1 or t2:
        score_tiempo = 0.75 #Cold+nan o warm+nan
    else:
        score_tiempo = 0.25 #nan+nan

    v1, v2 = p1.get('talla', 0), p2.get('talla', 0)
    if not ((v1 == 100 or v2 == 100) or abs(v1 - v2) <= 1): return 0.0

    c1, c2 = p1.get('sub_category'), p2.get('sub_category')
    if c1 == c2: return 0.0
    if (c1 in GR_ABAJO and c2 in GR_ABAJO) or \
       (c1 in GR_ENTERO and c2 in GR_ENTERO) or \
       (c1 in GR_CAPAS and c2 in GR_CAPAS): return 0.0
    
    if ((c1 in GR_ENTERO) and ((c2 in GR_ARRIBA) or (c2 in GR_ABAJO))) or \
       ((c2 in GR_ENTERO) and ((c1 in GR_ARRIBA) or (c1 in GR_ABAJO))): return 0.0

    # Largos y niveles
    l1, sl1, l2, sl2 = p1.get('long_cm'), p1.get('sleeve_long_cm'), p2.get('long_cm'), p2.get('sleeve_long_cm')
    is_cam_1, is_jer_2 = c1 in {'camiseta', 'top', 't-shirt', 'blusa', 'camisa'}, c2 in {'jersey', 'sudadera'}
    is_cam_2, is_jer_1 = c2 in {'camiseta', 'top', 't-shirt', 'blusa', 'camisa'}, c1 in {'jersey', 'sudadera'}
    
    if is_cam_1 and is_jer_2:
        if (l1 and l2 and l1 > l2) or (sl1 and sl2 and sl1 > sl2): return 0.0
    elif is_cam_2 and is_jer_1:
        if (l2 and l1 and l2 > l1) or (sl2 and sl1 and sl2 > sl1): return 0.0

    if p1.get('nivel') == 1 and p2.get('nivel') == 1: return 0.0
    if 'oversize' in p1.get('fits', []) and 'oversize' in p2.get('fits', []): return 0.0

    # =========================================================
    # FASE 5: ESTILO (FILTRO ESTRICTO)
    # =========================================================
    score_style = 0.0
    if p1.get('has_style') and p2.get('has_style'):
        s1, s2 = p1['styles'], p2['styles']
        r1, r2 = not s1.isdisjoint(C_RELAXED), not s2.isdisjoint(C_RELAXED)
        f1, f2 = not s1.isdisjoint(C_FORMAL), not s2.isdisjoint(C_FORMAL)
        b1, b2 = not s1.isdisjoint(C_BOHO), not s2.isdisjoint(C_BOHO)
        p1p, p2p = not s1.isdisjoint(C_PARTY), not s2.isdisjoint(C_PARTY)
        
        match = False
        if (r1 and r2) or (f1 and f2) or (b1 and b2) or (p1p and p2p):
            match = True
            score_style = 2
        elif (r1 and f2) or (r2 and f1) or (p1p and (f2 or r2)) or (p2p and (f1 or r1)):
            match = True
            score_style = 3
        if not match: return 0.0
    else:
        score_style = 0.0
    # =========================================================
    # FASE 6: PRINTS (FILTRO ESTRICTO)
    # =========================================================
    c_val1, c_val2 = p1.get('color_nivel', 0), p2.get('color_nivel', 0)
    h1, i1 = divmod(c_val1, 10)
    h2, i2 = divmod(c_val2, 10)
    has_p1, has_p2 = p1['is_print'], p2['is_print']
    score_print = 0.0
    if has_p1 and has_p2:
        pr1, pr2 = p1['prints'], p2['prints']
        es_liso_1, es_liso_2 = pr1.isdisjoint(G_LISO), pr2.isdisjoint(G_LISO)
        print_match = False
        if es_liso_1 or es_liso_2: 
            print_match = True
            score_print = 1.5
        elif not pr1.isdisjoint(G_CUADROS) and not pr2.isdisjoint(G_CUADROS):
            print_match = True
            score_print = 2
        else:
            dist_h = min(abs(h1 - h2), 12 - abs(h1 - h2))
            if dist_h == 0:
                if (not pr1.isdisjoint(G_AUDACES) and not pr2.isdisjoint(G_GEOMETRICOS)) or \
                   (not pr1.isdisjoint(G_ORGANICOS) and not pr2.isdisjoint(G_RAYAS)) or \
                   (not pr1.isdisjoint(G_PUNTOS) and not pr2.isdisjoint(G_RAYAS)):
                    print_match = True
                    score_print = 3
        if not print_match: return 0.0 
    else:
        if not has_p1 and not has_p2:
            score_print = 0.5 
        else:
            score_print = 0.7

    # =========================================================
    # FASE 7: COLOR (FILTRO ESTRICTO)
    # =========================================================
    score_color = 0.0
    is_n1, is_n2 = c_val1 in (0, 2, 4), c_val2 in (0, 2, 4)
    if is_n1 or is_n2:
        score_color = 1 if (is_n1 and is_n2) else 1.5
    else:
        dist = min(abs(h1 - h2), 12 - abs(h1 - h2))
        if dist == 0:
            if abs(i1 - i2) >= 2: score_color = 3
            else: return 0.0 
        elif dist == 1:
            score_color = 4
        elif dist in (4,6):
            score_color = 5
        else:
            return 0.0

    final_weight = score_tiempo+score_style + score_color + score_print
    peso_norm = final_weight/12.5
    return round(min(peso_norm, 1.0), 4)
</pre>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <footer class="bg-light py-4 mt-auto text-center">
      <p class="mb-0">&copy; 2026 Lookiero Azul Oscuro</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/script.js"></script>
</body>
</html>